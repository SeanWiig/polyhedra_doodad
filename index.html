<canvas id="c"></canvas>
<div id="debug">
  <pre></pre>
</div>
<style>
  html, body {
    margin: 0;
    height: 100%;
  }
  #c {
    width: 100%;
    height: 100%;
    display: block;
  }
</style>
<script type="module">
  import * as THREE from 'https://unpkg.com/three@0.127.0/build/three.module.js';

  function group(mesh) {
    const solid = new THREE.Mesh(
      mesh, new THREE.MeshNormalMaterial()
    );
    solid.material.transparent = true;
    const wire = new THREE.Mesh(
      mesh, new THREE.MeshNormalMaterial()
    );
    wire.material.wireframe = true;
    wire.material.transparent = true;
    const g = new THREE.Group();
    g.solid = solid;
    g.wire = wire;
    g.add(solid);
    g.add(wire);
    return g;
  };

  function main() {
      const canvas = document.querySelector('#c');
      const renderer = new THREE.WebGLRenderer({canvas});
      const aspect = renderer.domElement.clientWidth / renderer.domElement.clientHeight;
      //const camera = new THREE.PerspectiveCamera(75, aspect, 0.1, 1000);
      const camera = new THREE.OrthographicCamera(-300,300,300,-300,0.1,1000);
      camera.position.z = 500;
      const scene = new THREE.Scene();
      const backcolor = new THREE.Color(0x442233);
      scene.background = backcolor;
      const c = 2/Math.sqrt(3)
      const cube = group(new THREE.BoxGeometry(1,1,1));
      const octa = group(new THREE.OctahedronGeometry(1));
      octa.renderOrder = 2;
      //cube.position.x = 200

      const rotator = new THREE.Group();
      rotator.add(cube); rotator.add(octa);
      scene.add(rotator);
      let t1 = 0;
      let t2 = 0
      let octascale = 0;
      let cubescale = 0;
      const offset = (Math.log(2/3) / Math.log(3));
      //const offset = 0;
      function render(time) {
        time = time * 0.001;
        t1 = time * 0.2 % 1;
        t2 = (t1 + 0.5) % 1

        cubescale = Math.pow(3,offset+4+t1)
        cube.scale.fromArray([cubescale,cubescale,cubescale])
        cube.renderOrder = 3 - 2*(t2 >= t1)

        octascale = Math.pow(3,4+t2-0.5)
        octa.scale.fromArray([octascale,octascale,octascale])
        

        cube.solid.material.opacity = 3-4*t1;
        cube.wire.material.opacity = 4-4*t1;
        octa.solid.material.opacity = 3-4*t2;
        octa.wire.material.opacity = 4-4*t2;

        rotator.rotation.x = time*0.5;
        rotator.rotation.y = Math.PI/4;
        rotator.rotation.z = time*0.25;
        renderer.render(scene, camera);
        requestAnimationFrame(render);
      }
      requestAnimationFrame(render);
  }

  main();
</script>
